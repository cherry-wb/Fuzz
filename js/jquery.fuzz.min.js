(function($){$.fn.fuzz=function(options){var defaults={color:false,sepia:false,size:100,opacity:0.075,pixel:1},settings=$.extend({},defaults,options);function supports_canvas(){return!!document.createElement('canvas').getContext;}
if(supports_canvas()){$('<canvas id="jquery-fuzz">').appendTo($('body')).hide();var fuzzCanvas=document.getElementById('jquery-fuzz'),fuzzContext=fuzzCanvas.getContext('2d'),x,y,r,g,b,a=settings.opacity,px=Math.round(settings.pixel);if(settings.size>500){settings.size=500;}
if(px>settings.size){px=settings.size;}
if(px<1){px=1;}
fuzzCanvas.width=settings.size;fuzzCanvas.height=settings.size;for(x=0;x<fuzzCanvas.width;x+=px){for(y=0;y<fuzzCanvas.width;y+=px){r=Math.floor(Math.random()*255);g=Math.floor(Math.random()*255);b=Math.floor(Math.random()*255);if(!settings.color){fuzzContext.fillStyle='rgba('+r+', '+r+', '+r+', '+a+')';}else{fuzzContext.fillStyle='rgba('+r+', '+g+', '+b+', '+a+')';}
fuzzContext.fillRect(x,y,px,px);}}
if(settings.sepia){var imgData=fuzzContext.getImageData(0,0,fuzzCanvas.width,fuzzCanvas.height),pxData=imgData.data,pxLength=pxData.length;for(var i=0;i<pxLength;i+=4){var r=pxData[i],g=pxData[i+1],b=pxData[i+2],sR=r*.393+g*.769+b*.189,sG=r*.349+g*.686+b*.168,sB=r*.272+g*.534+b*.131;pxData[i]=sR;pxData[i+1]=sG;pxData[i+2]=sB;}
imgData.data=pxData;fuzzContext.putImageData(imgData,0,0);}
this.each(function(){if($(this).css('backgroundImage')){var currentBgImg=$(this).css('backgroundImage'),noise='url('+fuzzCanvas.toDataURL('image/png')+')',newBgImgVar=currentBgImg+', '+noise;$(this).css('backgroundImage',newBgImgVar);}else{this.style.backgroundImage='url('+fuzzCanvas.toDataURL('image/png')+')';}});$(fuzzCanvas).remove();}
return this;}})(jQuery);